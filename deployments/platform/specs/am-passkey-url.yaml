# Transform spec: /api/v1/auth/passkey → /am/json/authenticate?authIndexType=service&authIndexValue=WebAuthnJourney
#
# Request-side URL rewrite for the identifier-first passkey endpoint.
# Maps clean API URL to PingAM's authenticate endpoint with the
# WebAuthnJourney tree selected via query parameters.
#
# Body passes through unchanged (identity transform) — this is safe
# because D9 only restricts body-level request transforms, not URL rewrites.
#
id: am-passkey-url
version: "1.0.0"
description: "Rewrite /api/v1/auth/passkey → /am/json/authenticate + WebAuthnJourney"

input:
  schema:
    type: object

output:
  schema:
    type: object

transform:
  lang: jslt
  expr: "."

url:
  path:
    expr: '"/am/json/authenticate"'
  query:
    add:
      authIndexType: "service"
      authIndexValue: "WebAuthnJourney"

headers:
  add:
    Accept-API-Version: "resource=2.0,protocol=1.0"
